<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vaultify X тАФ Encrypted Vault</title>
  <meta name="description" content="Vaultify X тАУ client-side AES-GCM encrypted file vault" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--bg:#0a0f17;--text:#e7edf5;--muted:#9aa6b2;--accent:#22d3ee}
    body{background:var(--bg);color:var(--text);min-height:100vh;scroll-behavior:smooth}
    .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08)}
    .btn{display:inline-block;padding:.65rem 1.25rem;border-radius:.75rem;background:var(--accent);color:#000;font-weight:600}
    .btn:hover{background:#67e8f9}
    .focus-ring:focus{outline:2px solid var(--accent);outline-offset:2px}
    .fade{animation:fade .6s ease}@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
  </style>
</head>
<body class="font-sans">
  <main id="app" class="p-6 md:p-10 max-w-5xl mx-auto"></main>

  <!-- setup -->
  <template id="tpl-setup">
    <section class="glass rounded-3xl p-8 mt-20 text-center fade">
      <h1 class="text-3xl font-bold">Vaultify X</h1>
      <p class="text-[var(--muted)] mt-1">рждрзЛржорж╛рж░ ржирж┐рж░рж╛ржкржж ржПржиржХрзНрж░рж┐ржкрзНржЯрзЗржб ржнрж▓рзНржЯ рждрзИрж░рж┐ ржХрж░рзЛ ЁЯФТ</p>
      <form id="setupForm" class="mt-6 space-y-4 max-w-sm mx-auto text-left">
        <input id="setupPass" type="password" minlength="6" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus-ring" placeholder="ржирждрзБржи ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж╛ржУ">
        <input id="setupPass2" type="password" minlength="6" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus-ring" placeholder="ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржЖржмрж╛рж░ рж▓рж┐ржЦрзЛ">
        <button class="btn w-full">рж╕рзЗржн ржХрж░рзЛ ржПржмржВ ржЪрж╛рж▓рж┐рзЯрзЗ ржпрж╛ржУ</button>
      </form>
      <p class="text-xs text-[var(--muted)] mt-4">тЪая╕П ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржнрзБрж▓рзЗ ржЧрзЗрж▓рзЗ ржбрзЗржЯрж╛ ржлрзЗрж░ржд ржкрж╛ржУрзЯрж╛ ржпрж╛ржмрзЗ ржирж╛ред</p>
    </section>
  </template>

  <!-- login -->
  <template id="tpl-login">
    <section class="glass rounded-3xl p-8 mt-20 text-center fade">
      <h1 class="text-3xl font-bold">Vaultify X</h1>
      <p class="text-[var(--muted)] mt-1">ржкрзНрж░ржмрзЗрж╢ ржХрж░рждрзЗ рждрзЛржорж╛рж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж╛ржУ</p>
      <form id="loginForm" class="mt-6 space-y-4 max-w-sm mx-auto text-left">
        <input id="loginPass" type="password" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus-ring" placeholder="ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб">
        <button class="btn w-full">рж▓ржЧржЗржи</button>
      </form>
    </section>
  </template>

  <!-- shell -->
  <template id="tpl-shell">
    <div class="grid md:grid-cols-12 gap-6 fade">
      <aside class="md:col-span-3 lg:col-span-2 glass rounded-3xl p-5 space-y-4">
        <h2 class="text-xl font-semibold flex items-center gap-2">ЁЯФР Vaultify X</h2>
        <nav class="flex flex-col space-y-2">
          <button data-page="dashboard" class="px-3 py-2 text-left rounded-lg hover:bg-white/10">ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб</button>
          <button data-page="files" class="px-3 py-2 text-left rounded-lg hover:bg-white/10">ржлрж╛ржЗрж▓рж╕ржорзВрж╣</button>
          <button data-page="upload" class="px-3 py-2 text-left rounded-lg hover:bg-white/10">ржЖржкрж▓рзЛржб</button>
          <button data-page="settings" class="px-3 py-2 text-left rounded-lg hover:bg-white/10">рж╕рзЗржЯрж┐ржВрж╕</button>
        </nav>
        <button id="logoutBtn" class="mt-4 w-full py-2 rounded-lg border border-white/10 hover:bg-white/10 text-sm">рж▓ржЧржЖржЙржЯ</button>
      </aside>
      <section id="view" class="md:col-span-9 lg:col-span-10"></section>
    </div>
  </template>

<script>
// ---------- Helpers & DB ----------
const qs=(s,e=document)=>e.querySelector(s);const qsa=(s,e=document)=>[...e.querySelectorAll(s)];
const enc=new TextEncoder(),dec=new TextDecoder();
const dbName='vaultifyx-db',storeName='files',metaStore='meta';
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(dbName,1);r.onupgradeneeded=()=>{const db=r.result;if(!db.objectStoreNames.contains(storeName))db.createObjectStore(storeName,{keyPath:'id'});if(!db.objectStoreNames.contains(metaStore))db.createObjectStore(metaStore,{keyPath:'key'});};r.onsuccess=()=>res(r.result);r.onerror=()=>rej(r.error);});}
async function metaSet(k,v){const db=await openDB();const t=db.transaction(metaStore,'readwrite');t.objectStore(metaStore).put({key:k,value:v});return t.complete;}
async function metaGet(k){const db=await openDB();const t=db.transaction(metaStore,'readonly');const r=t.objectStore(metaStore).get(k);return new Promise(x=>{r.onsuccess=()=>x(r.result?.value||null);});}
async function dbGetAll(){const db=await openDB();const t=db.transaction(storeName,'readonly');const r=t.objectStore(storeName).getAll();return new Promise(x=>{r.onsuccess=()=>x(r.result||[]);});}
async function dbPut(f){const db=await openDB();const t=db.transaction(storeName,'readwrite');t.objectStore(storeName).put(f);return t.complete;}
async function dbDelete(id){const db=await openDB();const t=db.transaction(storeName,'readwrite');t.objectStore(storeName).delete(id);return t.complete;}
function prettySize(b){if(!b)return'0 B';const k=1024,s=['B','KB','MB','GB'],i=Math.floor(Math.log(b)/Math.log(k));return (b/Math.pow(k,i)).toFixed(1)+' '+s[i];}

// ---------- Crypto ----------
async function sha256(t){const h=await crypto.subtle.digest('SHA-256',enc.encode(t));return btoa(String.fromCharCode(...new Uint8Array(h)));}
async function deriveKey(p,s){const base=await crypto.subtle.importKey('raw',enc.encode(p),'PBKDF2',false,['deriveKey']);return crypto.subtle.deriveKey({name:'PBKDF2',salt:s,iterations:250000,hash:'SHA-256'},base,{name:'AES-GCM',length:256},false,['encrypt','decrypt']);}
async function encryptData(k,plain){const iv=crypto.getRandomValues(new Uint8Array(12));const buf=await crypto.subtle.encrypt({name:'AES-GCM',iv},k,plain);return{iv:Array.from(iv),data:Array.from(new Uint8Array(buf))};}
async function decryptData(k,ivA,dataA){const iv=new Uint8Array(ivA),data=new Uint8Array(dataA);return crypto.subtle.decrypt({name:'AES-GCM',iv},k,data);}

// ---------- State ----------
const state={key:null,files:[],logged:false};

// ---------- Init ----------
(async function init(){const app=qs('#app');const h=await metaGet('passHash');if(!h){app.innerHTML=qs('#tpl-setup').innerHTML;bindSetup();}else{app.innerHTML=qs('#tpl-login').innerHTML;bindLogin(h);}})();

function bindSetup(){qs('#setupForm').onsubmit=async e=>{e.preventDefault();const p1=qs('#setupPass').value.trim(),p2=qs('#setupPass2').value.trim();if(p1!==p2)return alert('ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржорж┐рж▓ржЫрзЗ ржирж╛');if(p1.length<6)return alert('ржХржоржкржХрзНрж╖рзЗ рзм ржЕржХрзНрж╖рж░');const h=await sha256(p1);await metaSet('passHash',h);const salt=crypto.getRandomValues(new Uint8Array(16));await metaSet('salt',Array.from(salt));location.reload();};}
function bindLogin(h){qs('#loginForm').onsubmit=async e=>{e.preventDefault();const p=qs('#loginPass').value;if(await sha256(p)!==h)return alert('ржнрзБрж▓ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб');const sA=await metaGet('salt');const key=await deriveKey(p,new Uint8Array(sA));state.key=key;state.logged=true;renderShell();};}

// ---------- UI ----------
async function renderShell(){const a=qs('#app');a.innerHTML=qs('#tpl-shell').innerHTML;qsa('nav button').forEach(b=>b.onclick=()=>{qsa('nav button').forEach(x=>x.classList.remove('bg-white/10'));b.classList.add('bg-white/10');renderPage(b.dataset.page);});qs('#logoutBtn').onclick=()=>location.reload();await refreshFiles();renderPage('dashboard');}
async function refreshFiles(){state.files=await dbGetAll();}
function renderPage(p){if(p==='dashboard')dash();if(p==='files')files();if(p==='upload')upload();if(p==='settings')settings();}

function dash(){const v=qs('#view'),c=state.files.length,t=state.files.reduce((n,f)=>n+f.size,0);v.innerHTML=`<div class="glass rounded-3xl p-6"><h2 class="text-2xl font-semibold mb-4">рж╕рзНржмрж╛ржЧрждржо ЁЯСЛ</h2><div class="grid md:grid-cols-3 gap-4"><div class="p-5 bg-white/5 rounded-2xl border border-white/10"><p class="text-sm text-[var(--muted)]">ржорзЛржЯ ржлрж╛ржЗрж▓</p><p class="text-3xl font-bold">${c}</p></div><div class="p-5 bg-white/5 rounded-2xl border border-white/10"><p class="text-sm text-[var(--muted)]">ржорзЛржЯ рж╕рж╛ржЗржЬ</p><p class="text-3xl font-bold">${prettySize(t)}</p></div><div class="p-5 bg-white/5 rounded-2xl border border-white/10 flex flex-col justify-between"><p class="text-sm text-[var(--muted)]">ржерж┐ржо</p><button id="toggleTheme" class="mt-2 py-2 rounded-lg border border-white/10 hover:bg-white/10">Dark/Light</button></div></div></div>`;qs('#toggleTheme').onclick=()=>document.documentElement.classList.toggle('invert');}

function files(){const v=qs('#view');if(!state.files.length){v.innerHTML=`<div class="glass rounded-3xl p-6 text-center"><p class="text-[var(--muted)]">ржХрзЛржирзЛ ржлрж╛ржЗрж▓ ржирзЗржЗ</p></div>`;return;}
v.innerHTML='<div class="space-y-4">'+state.files.sort((a,b)=>b.created-a.created).map(f=>{const d=new Date(f.created).toLocaleString();return`<article class="glass p-4 rounded-2xl border border-white/10 flex justify-between items-start"><div><h4 class="font-medium">${f.name}</h4><p class="text-xs text-[var(--muted)]">${prettySize(f.size)} тАв ${d}</p></div><div class="flex gap-2"><button data-id="${f.id}" data-act="download" class="px-3 py-1 rounded-lg border border-white/10 hover:bg-white/10 text-sm">тмЗя╕П</button><button data-id="${f.id}" data-act="delete" class="px-3 py-1 rounded-lg border border-white/10 hover:bg-white/10 text-sm">ЁЯЧСя╕П</button></div></article>`}).join('')+'</div>';
v.onclick=async e=>{const b=e.target.closest('button');if(!b)return;const f=state.files.find(x=>x.id===b.dataset.id);if(!f)return;if(b.dataset.act==='delete'){if(confirm('ржорзБржЫрзЗ ржлрзЗрж▓ржмрзЗржи?')){await dbDelete(f.id);await refreshFiles();files();}}else{try{const ab=await decryptData(state.key,f.iv,f.data);const blob=new Blob([ab],{type:f.type||'application/octet-stream'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=f.name;a.click();}catch{alert('ржбрж┐ржХрзНрж░рж┐ржкрзНржЯ ржмрзНржпрж░рзНрже');}}};}

function upload(){const v=qs('#view');v.innerHTML=`<div class="glass rounded-3xl p-6"><h2 class="text-xl font-semibold mb-4">ржирждрзБржи ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб</h2><form id="uploadForm" class="space-y-4"><input id="fileInput" type="file" multiple class="block w-full text-sm text-[var(--muted)] file:mr-4 file:bg-[var(--accent)] file:text-black file:px-4 file:py-2 file:rounded-md hover:file:opacity-90"><button class="btn w-full">ржЖржкрж▓рзЛржб</button></form><div id="progress" class="mt-4 text-sm text-[var(--muted)]"></div></div>`;
qs('#uploadForm').onsubmit=async e=>{e.preventDefault();const files=[...qs('#fileInput').files];if(!files.length)return alert('ржлрж╛ржЗрж▓ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи');const prog=qs('#progress');for(const f of files){prog.textContent=`Encrypting ${f.name}...`;const ab=await f.arrayBuffer();const ed=await encryptData(state.key,ab);await dbPut({id:crypto.randomUUID(),name:f.name,size:f.size,type:f.type,created:Date.now(),iv:ed.iv,data:ed.data});}await refreshFiles();alert('ржЖржкрж▓рзЛржб рж╕ржорзНржкржирзНржи');files();};}

function settings(){const v=qs('#view');v.innerHTML=`<div class="glass rounded-3xl p-6 space-y-6"><div><h3 class="text-lg font-semibold mb-2">ЁЯФС ржмрзНржпрж╛ржХржЖржк</h3><button id="backupBtn" class="btn">ржбрж╛ржЙржирж▓рзЛржб</button><label class="ml-3 px-4 py-2 rounded-lg border border-white/10 hover:bg-white/10 cursor-pointer">ржЗржоржкрзЛрж░рзНржЯ<input id="restoreInput" type="file" accept="application/json" class="hidden"></label></div><div><h3 class="text-lg font-semibold mb-2">ЁЯФР ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи</h3><form id="changeForm" class="grid md:grid-cols-3 gap-3"><input id="oldPass" type="password" placeholder="ржкрзБрж░рзЛржирзЛ" class="px-3 py-2 rounded-lg bg-white/5 border border-white/10"><input id="newPass" type="password" placeholder="ржирждрзБржи" class="px-3 py-2 rounded-lg bg-white/5 border border-white/10"><button class="btn">ржЖржкржбрзЗржЯ</button></form></div></div>`;
qs('#backupBtn').onclick=async()=>{const f=await dbGetAll();const json=JSON.stringify({ver:1,files:f});const blob=new Blob([json],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`vaultifyx-backup-${Date.now()}.vltx`;a.click();};
qs('#restoreInput').onchange=async e=>{const file=e.target.files[0];if(!file)return;try{const data=JSON.parse(await file.text());for(const f of data.files||[])await dbPut(f);await refreshFiles();alert('ржЗржоржкрзЛрж░рзНржЯ рж╕ржорзНржкржирзНржи');}catch{alert('ржЗржоржкрзЛрж░рзНржЯ ржмрзНржпрж░рзНрже');}};
qs('#changeForm').onsubmit=async e=>{e.preventDefault();const old=qs('#oldPass').value,nw=qs('#newPass').value;const s=await metaGet('passHash');if(await sha256(old)!==s)return alert('ржкрзБрж░рзЛржирзЛ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржнрзБрж▓');if(nw.length<6)return alert('ржХржоржкржХрзНрж╖рзЗ рзм ржЕржХрзНрж╖рж░');await metaSet('passHash',await sha256(nw));const salt=new Uint8Array(await metaGet('salt'));state.key=await deriveKey(nw,salt);alert('ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржЖржкржбрзЗржЯ');};}
</script>
</body>
</html>
